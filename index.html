<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
  </head>

  <body>
    <script>
      const config = {
        type: Phaser.AUTO,
        width: 900,
        height: 800,
        physics: {
          default: "arcade",
          arcade: {
            gravity: {
              y: 500
            }
          }
        },
        scene: {
          preload: preload,
          create: create,
          update: update
        }
      };

      const game = new Phaser.Game(config);

      function preload() {
        this.load.image(
          "logo",
          "https://raw.githubusercontent.com/DaniloDaqua/Dubito/master/img/bullshit1.jpg"
        );

        this.load.setBaseURL("http://labs.phaser.io");
        this.load.image("sky", "assets/skies/space3.png");
        this.load.image("red", "assets/particles/red.png");
      }

      function create() {
        this.add.image(450, 400, "sky");

        const logo = this.physics.add.image(100, 10, "logo");

        const particles = this.add.particles("red");

        const emitter = particles.createEmitter({
          speed: 5,
          scale: {
            start: 1,
            end: 0
          },
          blendMode: "ADD"
        });

        logo.setVelocity(5, 7);
        //logo.setBounce(1, 1);
        logo.setCollideWorldBounds(false);

        //emitter.startFollow(logo);
      }

      function update() {}

      function makeCard(suitNum = 0, number = 0) {
        const suitMap = {
          0: "clubs",
          1: "diamonds",
          2: "hearts",
          3: "spades"
        };
        const colorMap = {
          0: "black",
          1: "red",
          2: "red",
          3: "black"
        };
        const rankMap = {
          1: "ace",
          11: "jack",
          12: "queen",
          13: "king"
        };

        return {
          number: number,
          rank: rankMap[number] || number.toString(),
          suit: suitMap[suitNum],
          color: colorMap[suitNum]
        };
      }

      function makePlayer(name = "") {
        return {
          name: name,
          cards: [],
          addCard(card = {}) {
            this.cards.push(card);
            return this;
          },
          addCards(cards = []) {
            this.cards.concat(cards);
            return this;
          }
        };
      }

      const deck = [];
      const pile = [];

      // creare carte
      for (let number = 1; number < 14; number++) {
        for (let suit = 0; suit < 4; suit++) {
          deck.push(makeCard(suit, number));
        }
      }

      shuffle(deck);

      const players = [
        makePlayer("player"),
        makePlayer("bot 1"),
        makePlayer("bot 2"),
        makePlayer("bot 3")
      ];

      // dare le carte a i giocatori finchÃ¨ tutti possono averne 1 ad ogni giro
      while (deck.length >= players.length) {
        players.forEach(player => {
          player.addCard(deck.pop());
        });
      }

      // nel caso rimangono carte, mettile nel centro
      while (deck.length > 0) {
        pile.push(deck.pop());
      }

      console.table(deck);
      console.table(pile);
      console.table(players[0].cards);

      function shuffle(arra1) {
        let ctr = arra1.length;
        let temp;
        let index;

        // While there are elements in the array
        while (ctr > 0) {
          // Pick a random index
          index = Math.floor(Math.random() * ctr);
          // Decrease ctr by 1
          ctr--;
          // And swap the last element with it
          temp = arra1[ctr];
          arra1[ctr] = arra1[index];
          arra1[index] = temp;
        }
        return arra1;
      }
    </script>
  </body>
</html>
